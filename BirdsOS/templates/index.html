{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Status Cards Row -->
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">System Status</h5>
                    <p class="card-text" id="systemStatus">Loading...</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Storage</h5>
                    <p class="card-text" id="storageStatus">Loading...</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Network</h5>
                    <p class="card-text" id="networkStatus">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- GPIO Status Row -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">GPIO Status</h5>
                </div>
                <div class="card-body">
                    <div id="gpioStatus">Loading GPIO status...</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Update status functions
function updateSystemStatus() {
    fetch('/status')
        .then(response => response.json())
        .then(data => {
            document.getElementById('systemStatus').textContent = data.status;
        })
        .catch(error => {
            document.getElementById('systemStatus').textContent = 'Error loading status';
            console.error('Error:', error);
        });
}

function updateGPIOStatus() {
    fetch('/api/gpio/status')
        .then(response => response.json())
        .then(data => {
            const gpioDiv = document.getElementById('gpioStatus');
            const pins = data.pins;
            gpioDiv.innerHTML = Object.entries(pins).map(([pin, state]) => `
                <div class="mb-2">
                    <strong>Pin ${pin}:</strong> 
                    <span class="badge ${state ? 'bg-success' : 'bg-secondary'}">
                        ${state ? 'HIGH' : 'LOW'}
                    </span>
                </div>
            `).join('');
        })
        .catch(error => {
            document.getElementById('gpioStatus').textContent = 'Error loading GPIO status';
            console.error('Error:', error);
        });
}

// Initial updates
updateSystemStatus();
updateGPIOStatus();

// Update every 5 seconds
setInterval(updateSystemStatus, 5000);
setInterval(updateGPIOStatus, 5000);
</script>
{% endblock %}
